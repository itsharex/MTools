# 桌面应用程序开发准则（AI开发友好版）

## 1. 项目概述

本项目是一个多功能桌面应用程序，集成了音视频处理、编程语言编码转换、图片处理等功能。使用Python语言和Flet框架开发，遵循Material Design设计原则。

> **AI开发特别要求：**
> - 所有AI生成或辅助生成的代码，必须**强制添加类型提示**（Type Hints），包括函数参数、返回值、类属性等。
> - 生成代码应严格遵循本准则的命名、导入、结构、风格等规范。
> - 代码需易于人类理解和维护，避免生成晦涩难懂的实现。

## 2. 技术栈

- **核心语言**: Python 3.11.14
- **UI框架**: Flet 0.28.3 (设计规则遵循Material Design)
- **音视频处理**: ffmpeg-python
- **图片处理**: Pillow
- **编码转换**: chardet, iconv
- **打包工具**: nuitka

## 3. 项目结构规范

```
mytools/
├── src/                    # 源代码目录
│   ├── main.py            # 应用入口点
│   ├── assets/            # 静态资源
│   │   ├── icons/         # 图标文件
│   │   ├── images/        # 图片资源
│   │   └── fonts/         # 字体文件
│   ├── components/        # 可复用UI组件
│   ├── views/             # 页面视图
│   ├── utils/             # 工具函数
│   ├── services/          # 业务逻辑服务
│   ├── models/            # 数据模型
│   └── constants/         # 常量定义
├── tests/                 # 测试代码
├── docs/                  # 文档
├── requirements.txt       # 依赖列表
├── pyproject.toml         # 项目配置
├── README.md              # 项目说明
└── .gitignore             # Git忽略文件
└── .conda                 # conda运行环境
```

## 4. 模块管理规范

### 4.1 命名规范
- 模块名使用小写字母，单词间用下划线分隔 (snake_case)
- 类名使用大写字母开头的驼峰命名法 (PascalCase)
- 函数和变量名使用小写字母，单词间用下划线分隔 (snake_case)
- 常量名全部大写，单词间用下划线分隔 (UPPER_CASE)
- 模块头部按照规范明确utf-8编码

### 4.2 导入规范
- 标准库导入放在最前面
- 第三方库导入放在标准库后面
- 本地应用导入放在最后
- 每个导入组之间用空行分隔

- 每个文件应该有明确的单一职责
- 复杂功能应拆分为多个小函数
- 避免过长的函数和类
### 4.3 代码组织
- 每个文件应该有明确的单一职责
- 复杂功能应拆分为多个小函数
- 避免过长的函数和类
- **所有函数、方法、类属性必须添加类型提示（Type Hints）**，无论是手写还是AI生成
- 使用类型提示提高代码可读性和可维护性
- 当视图拥有多级时，代码结构也要按照对应的层级设计，区分父级、子级目录和文件

#### 4.4 注释与文档规范
- 所有模块、类、函数、方法必须使用现代编辑器可解析的文档字符串（docstring），推荐Google或reStructuredText风格
- 重要变量、复杂逻辑应有必要的行内注释
- 类型注释应与docstring配合，便于IDE和AI工具自动识别
- 注释和docstring应保持格式规范，便于现代编辑器和AI工具解析
- 示例：
	```python
	def foo(bar: int) -> str:
		"""
		对bar进行处理并返回字符串。

		Args:
			bar (int): 输入参数

		Returns:
			str: 处理结果
		"""
		# ...实现...
	```

## 5. Material Design设计原则

### 5.1 颜色系统
- 使用Material Design调色板
- 主色(primary)、次色(secondary)、错误色(error)等应保持一致
- 深色/浅色主题支持

### 5.2 组件使用
- 优先使用Flet提供的Material组件
- 遵循Material Design的交互模式
- 保持一致的间距和对齐

### 5.3 响应式设计
- 适配不同屏幕尺寸
- 合理使用布局组件，确保整体视觉效果统一
- 支持窗口大小调整

## 6. 功能模块设计准则

### 6.1 音视频处理模块
- 使用ffmpeg-python作为核心处理库
- 提供常见的音视频格式转换功能
- 支持批量处理
- 提供进度反馈和错误处理

### 6.2 编码转换模块
- 使用chardet进行编码检测
- 支持常见编码格式(UTF-8, GBK, GB2312, ASCII等)
- 提供编码批量转换功能
- 保留文件权限和元数据

### 6.3 图片处理模块
- 使用Pillow作为核心处理库
- 提供格式转换、尺寸调整、滤镜等功能
- 支持批量处理
- 保持图片质量选项

### 6.4 其他模块
- 遵照统一的设计规范进行设计

## 7. 代码质量保证

### 7.1 代码格式化
- 使用black进行代码格式化
- 使用isort整理导入语句
- AI生成代码后，建议自动运行black和isort进行格式化和导入优化

### 7.2 代码检查
- 使用flake8进行代码风格检查
- 使用mypy进行类型检查，**AI生成代码必须通过mypy类型检查**

### 7.3 测试
- 单元测试覆盖率不低于80%
- 使用pytest作为测试框架
- 集成测试覆盖主要功能流程
- AI生成的代码建议自动生成或补充相应的单元测试

## 8. 版本控制规范（AI开发补充）

### 8.1 提交信息规范
- 使用约定式提交格式
- 提交信息应清晰描述变更内容
- AI生成代码的提交需在备注中注明“AI生成”或“AI辅助”

### 8.2 分支管理
- 主分支(main)保持稳定
- 功能开发使用特性分支
- 发布版本使用标签管理

## 9. 打包和部署

### 9.1 应用打包
- 使用buitka_build.bat进行应用打包
- 为不同平台提供对应的安装包
- 禁止自行打包测试，这一步必须由开发人员完成

### 9.2 版本发布
- 遵循语义化版本规范
- 提供更新日志
- 确保向后兼容性

## 10. 性能优化

### 10.1 资源管理
- 及时释放不需要的资源
- 合理使用缓存机制

### 10.2 异步处理
- 耗时操作使用异步处理
- 避免阻塞UI线程

### 10.3 内存优化
- 避免内存泄漏
- 合理管理大文件处理
