# 字体选择器功能说明

## 功能概述

字体选择器功能已升级为弹窗形式，提供更好的用户体验和更多功能。

## 主要特性

### 1. 弹窗式字体选择
- 点击"选择字体"按钮打开字体选择对话框
- 对话框显示当前选中的字体
- 支持关闭按钮退出对话框

### 2. 系统字体自动检测
- 自动扫描系统已安装的所有字体
- 支持 Windows、macOS 和 Linux 系统
- 智能识别常见中文字体并显示中文名称

### 3. 字体列表展示
- 列出所有可用字体（共找到 XX 个字体）
- 每个字体项显示：
  - 字体显示名称（中文/英文）
  - 使用该字体渲染的示例文本
  - 选中状态图标
- 当前选中的字体高亮显示

### 4. 搜索过滤功能
- 搜索框支持实时过滤字体列表
- 可按字体名称或显示名称搜索
- 支持中英文搜索

### 5. 自定义字体输入
- 对话框底部提供自定义字体输入框
- 用户可以手动输入任意字体名称
- 点击"应用自定义字体"按钮应用自定义字体

### 6. 实时预览
- 选择字体后，字体预览区域立即更新
- 主界面的当前字体按钮显示更新
- 部分界面元素立即应用新字体

## 使用方法

1. 打开"设置"页面
2. 找到"字体设置"部分
3. 点击当前字体按钮打开字体选择对话框
4. 在对话框中：
   - **方式一**：直接点击列表中的字体应用
   - **方式二**：使用搜索框快速查找字体
   - **方式三**：在底部输入自定义字体名称并点击"应用"
5. 字体应用后对话框自动关闭
6. 重启应用使字体完全生效

## 技术实现

### 文件修改

1. **src/utils/file_utils.py**
   - 新增 `get_system_fonts()` 函数：获取系统字体列表
   - 新增 `_get_windows_fonts()` 函数：Windows 字体扫描
   - 新增 `_get_macos_fonts()` 函数：macOS 字体扫描
   - 新增 `_get_linux_fonts()` 函数：Linux 字体扫描
   - 新增 `_get_font_display_name()` 函数：字体名称映射

2. **src/views/settings_view.py**
   - 修改 `_build_font_section()` 方法：改用按钮触发对话框
   - 新增 `_open_font_selector_dialog()` 方法：打开字体选择对话框
   - 新增 `_filter_font_list()` 方法：过滤字体列表
   - 新增 `_apply_font_selection()` 方法：应用选中的字体
   - 新增 `_close_font_selector_dialog()` 方法：关闭对话框

### 字体检测逻辑

#### Windows
- 扫描 `%SystemRoot%\Fonts` 目录
- 识别 .ttf、.otf、.ttc、.fon 文件
- 预置常见 Windows 字体列表

#### macOS
- 扫描 `/System/Library/Fonts`、`/Library/Fonts`、`~/Library/Fonts`
- 识别 .ttf、.otf、.ttc、.dfont 文件
- 预置常见 macOS 字体列表

#### Linux
- 优先使用 `fc-list` 命令获取字体
- 备用方案：扫描 `/usr/share/fonts` 等目录
- 预置常见 Linux 字体列表

## 字体名称映射

系统自动将常见字体的英文名映射为中文名，例如：
- Microsoft YaHei → 微软雅黑
- SimSun → 宋体
- SimHei → 黑体
- PingFang SC → 苹方-简
- Noto Sans CJK SC → 思源黑体-简

## 注意事项

1. 字体更改后需要重启应用才能完全生效
2. 自定义字体需要确保系统已安装该字体
3. Linux 系统如果没有 `fc-list` 命令，可能检测到的字体较少
4. 字体列表会自动去重并按字母顺序排序
5. "系统默认"字体始终显示在列表最前面

## 未来改进方向

- [ ] 支持字体预览文本自定义
- [ ] 添加字体收藏功能
- [ ] 支持字体样式选择（粗体、斜体等）
- [ ] 添加最近使用字体列表
- [ ] 支持字体大小与字体同时在对话框中调整

